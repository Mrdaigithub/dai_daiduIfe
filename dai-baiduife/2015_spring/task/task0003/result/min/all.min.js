"use strict";!function(){function e(e,t){var a=JSON.parse(localStorage.getItem("localData"));if(e){for(var l=0;l<a.length;l++)if(a[l].folderName===t){a.splice(l,1),localStorage.setItem("localData",JSON.stringify(a));break}}else for(var l=0;l<a.length;l++)for(var n=0;n<a[l].files.length;n++)if(a[l].files[n].fileName===t)return a[l].files.splice(n,1),localStorage.setItem("localData",JSON.stringify(a)),0}function t(e){var t=I.cloneNode(!0);t.children[0].children[0].innerText=e,p.appendChild(t),B.style.display="none"}function a(e){var t=b.cloneNode(!0);t.children[0].innerText=e,null===k?alert("请先选中要添加task的文件夹~"):"H4"===k.nodeName?k.parentNode.children[1].appendChild(t):"LI"===k.nodeName&&k.parentNode.appendChild(t),B.style.display="none"}function l(e,t){var a=b.cloneNode(!0);a.children[0].innerText=e,t.children[1].appendChild(a)}function n(){for(var e=0;e<E.length;e++)if(k.children[0].innerText===E[e].folderName)return e}function r(e,t){if(null!==E)if(e){for(var a=0;a<E.length;a++)if(E[a].folderName===t)return!0}else for(var a=0;a<E.length;a++)for(var l=0;l<E[a].files.length;l++)if(E[a].files[l].fileName===t)return!0;return!1}function i(){for(var e=JSON.parse(localStorage.getItem("localData")),t={taskName:x.value,taskDate:J.value,taskContent:H.value,complete:!1},a=0;a<e.length;a++)for(var l=0;l<e[a].files.length;l++)if(e[a].files[l].fileName===k.children[0].innerText)return e[a].files[l].taskList.push(t),e}function o(e,t){var a=q.cloneNode(!0);F.appendChild(a);var l=j.cloneNode(!0);l.innerText=t,a.appendChild(l);var n=R.cloneNode(!0);a.appendChild(n);var r=z.cloneNode(!0);r.innerText=e,n.appendChild(r),g(r)&&(r.className="taskCpmplete")}function s(){var e=JSON.parse(localStorage.getItem("localData"));if(null!==e){for(var t=F.children.length;t>0;t--)F.removeChild(F.children[0]);console.log(e);for(var a=0;a<e.length;a++)for(var l=0;l<e[a].files.length;l++)for(var n=0;n<e[a].files[l].taskList.length;n++){var r=F.getElementsByClassName("taskDate");if(r.length>0)for(var t=0;t<r.length;t++){if(e[a].files[l].taskList[n].taskDate===r[t].innerText){var i=z.cloneNode(!0);i.innerText=e[a].files[l].taskList[n].taskName,r[t].parentNode.children[1].appendChild(i),g(i)&&(i.className="taskCpmplete")}else o(e[a].files[l].taskList[n].taskName,e[a].files[l].taskList[n].taskDate);break}else o(e[a].files[l].taskList[n].taskName,e[a].files[l].taskList[n].taskDate)}}}function d(e,t,a){console.log(arguments),T.style.display="none",x.style.display="block",D.style.display="none",J.style.display="inline-block",O.style.display="none",H.style.display="block",W.style.display="none",e?x.value=e:x.value=null,t?J.value=t:J.value=null,a?H.value=a:H.value=null}function c(e,t,a){T.style.display="block",x.style.display="none",D.style.display="inline-block",J.style.display="none",O.style.display="block",H.style.display="none",W.style.display="block",e?T.innerText=e:T.innerText=null,t?D.innerText=t:D.innerText=null,a?O.innerText=a:O.innerText=null}function g(e,t){for(var a=JSON.parse(localStorage.getItem("localData")),l=0;l<a.length;l++)for(var n=0;n<a[l].files.length;n++)for(var r=0;r<a[l].files[n].taskList.length;r++)if(a[l].files[n].taskList[r].taskName===e.innerText)return t&&(a[l].files[n].taskList[r].complete=t,localStorage.setItem("localData",JSON.stringify(a))),a[l].files[n].taskList[r].complete}function f(e){for(var t=JSON.parse(localStorage.getItem("localData")),a=0;a<t.length;a++)for(var l=0;l<t[a].files.length;l++)for(var n=0;n<t[a].files[l].taskList.length;n++)if(t[a].files[l].taskList[n].taskName===e)return t[a].files[l].taskList[n]}var m=document,N=m.getElementsByClassName("tasklist"),p=m.getElementById("taskBox"),u=m.getElementsByClassName("main")[0],y=m.getElementsByClassName("middle")[0],v=m.getElementsByClassName("addBtn"),h=m.getElementsByClassName("title")[0],k=null,C=h.children[0],E=[];u.style.height=window.innerHeight-60+"px",v[1].style.width=window.getComputedStyle(y,null).width||y.currentStyle.width,v[1].style.width=y.innerWidth,window.addEventListener("resize",function(){u.style.height=window.innerHeight-60+"px",v[1].style.width=window.getComputedStyle(y,null).width||y.currentStyle.width},!1),p.addEventListener("click",function(t){var a=window.event||t;"closeBtn"===a.target.className&&"H4"===a.target.parentNode.nodeName?confirm("Are you sure ?")&&(a.target.parentNode.parentNode.parentNode.removeChild(a.target.parentNode.parentNode),e(!0,a.target.parentNode.children[0].innerText)):"closeBtn"===a.target.className&&"LI"===a.target.parentNode.nodeName?confirm("Are you sure ?")&&(a.target.parentNode.parentNode.removeChild(a.target.parentNode),e(!1,a.target.parentNode.children[0].innerText)):("H4"===a.target.nodeName||"LI"===a.target.nodeName||"H4"===a.target.parentNode.nodeName||"LI"===a.target.parentNode.nodeName)&&(k&&(k.style.backgroundColor=null),"H4"===a.target.parentNode.nodeName?(a.target.parentNode.style.backgroundColor="rgb(255,255,255)",k=a.target.parentNode):"LI"===a.target.parentNode.nodeName?(a.target.parentNode.style.backgroundColor="rgb(255,255,255)",k=a.target.parentNode):(a.target.style.backgroundColor="rgb(255,255,255)",k=a.target))},!1),p.addEventListener("dblclick",function(e){var t=window.event||e;"H4"===t.target.nodeName?"block"===t.target.parentNode.children[1].style.display?t.target.parentNode.children[1].style.display="none":t.target.parentNode.children[1].style.display="block":"H4"===t.target.parentNode.nodeName&&("block"===t.target.parentNode.parentNode.children[1].style.display?t.target.parentNode.parentNode.children[1].style.display="none":t.target.parentNode.parentNode.children[1].style.display="block")},!1);var B=m.getElementById("mask"),L=m.getElementById("createTask"),w=m.getElementById("taskName"),I=N[0].cloneNode(!0),b=N[0].getElementsByTagName("ul")[0].getElementsByTagName("li")[0].cloneNode(!0),S=m.createElement("ul");S.style.display="block",I.removeChild(I.children[1]),I.appendChild(S),v[0].addEventListener("click",function(){B.style.display="block"},!1),L.addEventListener("click",function(e){var l=window.event||e;if(E=JSON.parse(localStorage.getItem("localData")),null===E&&(E=[]),"noBtn"===l.target.id)B.style.display="none";else if("okBtn"===l.target.id){var i=L.getElementsByTagName("input")[1];if(i.checked){if(r(!0,w.value))return alert("重复创建"),0;t(w.value);var o={folderName:w.value,files:[]};E.push(o),w.value=null}else{if(r(!1,w.value))return alert("重复创建"),0;if(a(w.value),"H4"===k.nodeName){var s=n(),d={fileName:w.value,taskList:[]};E[s].files.push(d)}w.value=null}}localStorage.setItem("localData",JSON.stringify(E))},!1),function(){var e=JSON.parse(localStorage.getItem("localData"));if(null!==e)for(var a=0;a<e.length;a++){t(e[a].folderName);for(var n=0;n<e[a].files.length;n++)l(e[a].files[n].fileName,N[a+1])}}();var T=(m.getElementsByClassName("rightTitle"),m.getElementById("rightTitleName")),x=m.getElementById("inputTaskName"),D=m.getElementById("rightDateSpan"),J=m.getElementById("inputDate"),O=m.getElementById("rightContentRead"),H=m.getElementById("rightContentWrite"),A=m.getElementById("saveBtn"),W=m.getElementById("btnBox");h.addEventListener("click",function(e){var t=window.event||e;"A"===t.target.nodeName&&(C.style.backgroundColor=null,t.target.style.backgroundColor="rgb(255, 255, 255)",C=t.target)},!1),v[1].addEventListener("click",function(){d()},!1);var z=m.createElement("li"),R=m.createElement("ul"),j=m.createElement("div"),q=m.createElement("div"),F=m.getElementById("dataTaskBox");q.className="dataTask",j.className="taskDate",s(),A.addEventListener("click",function(e){var t=window.event||e;if(k){if(t.target===this.children[1]){console.log("ok");var a=i();console.log(JSON.stringify(a)),c(),localStorage.setItem("localData",JSON.stringify(a)),s()}}else alert("先选一个task文件目录文件")},!1);var G=null;F.addEventListener("click",function(e){var t=window.event||e;if("LI"===t.target.nodeName){null!==G&&(G.style.backgroundColor=null),t.target.style.backgroundColor="rgb(242,242,242)",G=t.target;var a=f(G.innerText);c(a.taskName,a.taskDate,a.taskContent)}},!1),W.addEventListener("click",function(e){var t=window.event||e;if(null!==G){if(t.target===this.children[0])G.className="taskCpmplete",g(G,!0);else if(t.target===this.children[1]){var a=f(G.innerText);console.log(a),d(a.taskName,a.taskData,a.taskContent)}}else alert("先选一个task")},!1)}();