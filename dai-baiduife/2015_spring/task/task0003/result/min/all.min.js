"use strict";!function(){function e(e,t){var a=JSON.parse(localStorage.getItem("localData"));if(e){for(var l=0;l<a.length;l++)if(a[l].folderName===t){a.splice(l,1),localStorage.setItem("localData",JSON.stringify(a));break}}else for(var l=0;l<a.length;l++)for(var n=0;n<a[l].files.length;n++)if(a[l].files[n].fileName===t)return a[l].files.splice(n,1),localStorage.setItem("localData",JSON.stringify(a)),0}function t(e){var t=E.cloneNode(!0);t.children[0].children[0].innerText=e,g.appendChild(t),v.style.display="none"}function a(e){var t=B.cloneNode(!0);t.children[0].innerText=e,null===y?alert("请先选中要添加task的文件夹~"):"H4"===y.nodeName?y.parentNode.children[1].appendChild(t):"LI"===y.nodeName&&y.parentNode.appendChild(t),v.style.display="none"}function l(e,t){var a=B.cloneNode(!0);a.children[0].innerText=e,t.children[1].appendChild(a)}function n(){for(var e=0;e<u.length;e++)if(y.children[0].innerText===u[e].folderName)return e}function r(e,t){if(null!==u)if(e){for(var a=0;a<u.length;a++)if(u[a].folderName===t)return!0}else for(var a=0;a<u.length;a++)for(var l=0;l<u[a].files.length;l++)if(u[a].files[l].fileName===t)return!0;return!1}function i(){for(var e=JSON.parse(localStorage.getItem("localData")),t={taskName:b.value,taskData:S.value,taskContent:D.value,complete:!1},a=0;a<e.length;a++)for(var l=0;l<e[a].files.length;l++)if(e[a].files[l].fileName===y.children[0].innerText)return e[a].files[l].taskList.push(t),e}function o(e){if(null!==e){for(var t=z.children.length;t>0;t--)z.removeChild(z.children[0]);for(var a=0;a<e.length;a++)for(var l=0;l<e[a].files.length;l++)for(var n=0;n<e[a].files[l].taskList.length;n++)if(0===z.children.length){var r=W.cloneNode(!0);z.appendChild(r);var i=A.cloneNode(!0);i.innerText=e[a].files[l].taskList[n].taskData,r.appendChild(i);var o=H.cloneNode(!0);r.appendChild(o);var s=O.cloneNode(!0);if(s.innerText=e[a].files[l].taskList[n].taskName,o.appendChild(s),e[a].files[l].taskList[n].complete===!0)s.className="taskCpmplete";else if(z.getElementsByClassName("taskDate")[t].innerText===e[a].files[l].taskList[n].taskData)console.log(z.getElementsByClassName("taskDate")[t].innerText),console.log(e[a].files[l].taskList[n].taskData),z.getElementsByClassName("taskDate")[t].parentNode.appendChild(i);else{var r=W.cloneNode(!0);z.appendChild(r);var i=A.cloneNode(!0);i.innerText=e[a].files[l].taskList[n].taskData,r.appendChild(i);var o=H.cloneNode(!0);r.appendChild(o);var s=O.cloneNode(!0);s.innerText=e[a].files[l].taskList[n].taskName,o.appendChild(s),e[a].files[l].taskList[n].complete===!0&&(s.className="taskCpmplete")}}}}function s(e,t){for(var a=JSON.parse(localStorage.getItem("localData")),l=0;l<a.length;l++)for(var n=0;n<a[l].files.length;n++)for(var r=0;r<a[l].files[n].taskList.length;r++)if(a[l].files[n].taskList[r].taskName===e)return a[l].files[n].taskList[r].complete=t,localStorage.setItem("localData",JSON.stringify(a)),0}var d=document,c=d.getElementsByClassName("tasklist"),g=d.getElementById("taskBox"),p=d.getElementsByClassName("main")[0],m=d.getElementsByClassName("middle")[0],N=d.getElementsByClassName("addBtn"),f=d.getElementsByClassName("title")[0],y=null,h=f.children[0],u=[];p.style.height=window.innerHeight-60+"px",N[1].style.width=window.getComputedStyle(m,null).width||m.currentStyle.width,N[1].style.width=m.innerWidth,window.addEventListener("resize",function(){p.style.height=window.innerHeight-60+"px",N[1].style.width=window.getComputedStyle(m,null).width||m.currentStyle.width},!1),g.addEventListener("click",function(t){var a=window.event||t;"closeBtn"===a.target.className&&"H4"===a.target.parentNode.nodeName?confirm("Are you sure ?")&&(a.target.parentNode.parentNode.parentNode.removeChild(a.target.parentNode.parentNode),e(!0,a.target.parentNode.children[0].innerText)):"closeBtn"===a.target.className&&"LI"===a.target.parentNode.nodeName?confirm("Are you sure ?")&&(a.target.parentNode.parentNode.removeChild(a.target.parentNode),e(!1,a.target.parentNode.children[0].innerText)):("H4"===a.target.nodeName||"LI"===a.target.nodeName||"H4"===a.target.parentNode.nodeName||"LI"===a.target.parentNode.nodeName)&&(y&&(y.style.backgroundColor=null),"H4"===a.target.parentNode.nodeName?(a.target.parentNode.style.backgroundColor="rgb(255,255,255)",y=a.target.parentNode):"LI"===a.target.parentNode.nodeName?(a.target.parentNode.style.backgroundColor="rgb(255,255,255)",y=a.target.parentNode):(a.target.style.backgroundColor="rgb(255,255,255)",y=a.target))},!1),g.addEventListener("dblclick",function(e){var t=window.event||e;"H4"===t.target.nodeName?"block"===t.target.parentNode.children[1].style.display?t.target.parentNode.children[1].style.display="none":t.target.parentNode.children[1].style.display="block":"H4"===t.target.parentNode.nodeName&&("block"===t.target.parentNode.parentNode.children[1].style.display?t.target.parentNode.parentNode.children[1].style.display="none":t.target.parentNode.parentNode.children[1].style.display="block")},!1);var v=d.getElementById("mask"),k=d.getElementById("createTask"),C=d.getElementById("taskName"),E=c[0].cloneNode(!0),B=c[0].getElementsByTagName("ul")[0].getElementsByTagName("li")[0].cloneNode(!0),w=d.createElement("ul");w.style.display="block",E.removeChild(E.children[1]),E.appendChild(w),N[0].addEventListener("click",function(){v.style.display="block"},!1),k.addEventListener("click",function(e){var l=window.event||e;if(u=JSON.parse(localStorage.getItem("localData")),null===u&&(u=[]),"noBtn"===l.target.id)v.style.display="none";else if("okBtn"===l.target.id){var i=k.getElementsByTagName("input")[1];if(i.checked){if(r(!0,C.value))return alert("重复创建"),0;t(C.value);var o={folderName:C.value,files:[]};u.push(o),C.value=null}else{if(r(!1,C.value))return alert("重复创建"),0;if(a(C.value),"H4"===y.nodeName){var s=n(),d={fileName:C.value,taskList:[]};u[s].files.push(d)}C.value=null}}localStorage.setItem("localData",JSON.stringify(u))},!1),function(){var e=JSON.parse(localStorage.getItem("localData"));if(null!==e)for(var a=0;a<e.length;a++){t(e[a].folderName);for(var n=0;n<e[a].files.length;n++)l(e[a].files[n].fileName,c[a+1])}}();var I=(d.getElementsByClassName("rightTitle"),d.getElementById("rightTitleName")),b=d.getElementById("inputTaskName"),L=d.getElementById("rightDateSpan"),S=d.getElementById("inputDate"),T=d.getElementById("rightContentRead"),D=d.getElementById("rightContentWrite"),x=d.getElementById("saveBtn"),J=d.getElementById("btnBox");f.addEventListener("click",function(e){var t=window.event||e;"A"===t.target.nodeName&&(h.style.backgroundColor=null,t.target.style.backgroundColor="rgb(255, 255, 255)",h=t.target)},!1),N[1].addEventListener("click",function(){I.style.display="none",b.style.display="block",L.style.display="none",S.style.display="inline-block",T.style.display="none",D.style.display="block",J.style.display="none"},!1);var O=d.createElement("li"),H=d.createElement("ul"),A=d.createElement("div"),W=d.createElement("div"),z=d.getElementById("dataTaskBox");W.className="dataTask",A.className="taskDate",o(JSON.parse(localStorage.getItem("localData"))),x.addEventListener("click",function(e){var t=window.event||e,a=i();t.target===this.children[1]&&(I.style.display="block",b.style.display="none",L.style.display="inline-block",S.style.display="none",T.style.display="block",D.style.display="none",J.style.display="block",localStorage.setItem("localData",JSON.stringify(a)),o(a))},!1);var R=null;z.addEventListener("click",function(e){var t=window.event||e;"LI"===t.target.nodeName&&(null!==R&&(R.style.backgroundColor=null),t.target.style.backgroundColor="rgb(242,242,242)",R=t.target)},!1);var J=document.getElementById("btnBox");J.addEventListener("click",function(e){var t=window.event||e;t.target===this.children[0]&&(R.className="taskCpmplete",s(R.innerText,!0))},!1)}();