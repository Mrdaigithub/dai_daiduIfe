"use strict";!function(){function e(e,t){var a=JSON.parse(localStorage.getItem("localData"));if(e){for(var l=0;l<a.length;l++)if(a[l].folderName===t){a.splice(l,1),localStorage.setItem("localData",JSON.stringify(a));break}}else for(var l=0;l<a.length;l++)for(var n=0;n<a[l].files.length;n++)if(a[l].files[n].fileName===t)return a[l].files.splice(n,1),localStorage.setItem("localData",JSON.stringify(a)),0}function t(e){var t=E.cloneNode(!0);t.children[0].children[0].innerText=e,c.appendChild(t),h.style.display="none"}function a(e){var t=B.cloneNode(!0);t.children[0].innerText=e,null===m?alert("请先选中要添加task的文件夹~"):"H4"===m.nodeName?m.parentNode.children[1].appendChild(t):"LI"===m.nodeName&&m.parentNode.appendChild(t),h.style.display="none"}function l(e,t){var a=B.cloneNode(!0);a.children[0].innerText=e,t.children[1].appendChild(a)}function n(){for(var e=0;e<u.length;e++)if(m.children[0].innerText===u[e].folderName)return e}function r(e,t){if(null!==u)if(e){for(var a=0;a<u.length;a++)if(u[a].folderName===t)return!0}else for(var a=0;a<u.length;a++)for(var l=0;l<u[a].files.length;l++)if(u[a].files[l].fileName===t)return!0;return!1}function i(){for(var e=JSON.parse(localStorage.getItem("localData")),t={taskName:I.value,taskData:S.value,taskContent:T.value,complete:!1},a=0;a<e.length;a++)for(var l=0;l<e[a].files.length;l++)if(e[a].files[l].fileName===m.children[0].innerText)return e[a].files[l].taskList.push(t),e}function o(e){if(null!==e){for(var t=W.children.length;t>0;t--)W.removeChild(W.children[0]);for(var a=0;a<e.length;a++)for(var l=0;l<e[a].files.length;l++)for(var n=0;n<e[a].files[l].taskList.length;n++){var r=A.cloneNode(!0),i=O.cloneNode(!0),o=J.cloneNode(!0),d=H.cloneNode(!0);d.innerText=e[a].files[l].taskList[n].taskName,i.innerText=e[a].files[l].taskList[n].taskData,W.appendChild(r),r.appendChild(i),r.appendChild(o),o.appendChild(d)}}}var d=document,s=d.getElementsByClassName("tasklist"),c=d.getElementById("taskBox"),g=d.getElementsByClassName("main")[0],p=d.getElementsByClassName("middle")[0],y=d.getElementsByClassName("addBtn"),N=d.getElementsByClassName("title")[0],m=null,f=N.children[0],u=[];g.style.height=window.innerHeight-60+"px",y[1].style.width=window.getComputedStyle(p,null).width||p.currentStyle.width,y[1].style.width=p.innerWidth,window.addEventListener("resize",function(){g.style.height=window.innerHeight-60+"px",y[1].style.width=window.getComputedStyle(p,null).width||p.currentStyle.width},!1),c.addEventListener("click",function(t){var a=window.event||t;"closeBtn"===a.target.className&&"H4"===a.target.parentNode.nodeName?confirm("Are you sure ?")&&(a.target.parentNode.parentNode.parentNode.removeChild(a.target.parentNode.parentNode),e(!0,a.target.parentNode.children[0].innerText)):"closeBtn"===a.target.className&&"LI"===a.target.parentNode.nodeName?confirm("Are you sure ?")&&(a.target.parentNode.parentNode.removeChild(a.target.parentNode),e(!1,a.target.parentNode.children[0].innerText)):("H4"===a.target.nodeName||"LI"===a.target.nodeName||"H4"===a.target.parentNode.nodeName||"LI"===a.target.parentNode.nodeName)&&(m&&(m.style.backgroundColor=null),"H4"===a.target.parentNode.nodeName?(a.target.parentNode.style.backgroundColor="rgb(255,255,255)",m=a.target.parentNode):"LI"===a.target.parentNode.nodeName?(a.target.parentNode.style.backgroundColor="rgb(255,255,255)",m=a.target.parentNode):(a.target.style.backgroundColor="rgb(255,255,255)",m=a.target))},!1),c.addEventListener("dblclick",function(e){var t=window.event||e;"H4"===t.target.nodeName?"block"===t.target.parentNode.children[1].style.display?t.target.parentNode.children[1].style.display="none":t.target.parentNode.children[1].style.display="block":"H4"===t.target.parentNode.nodeName&&("block"===t.target.parentNode.parentNode.children[1].style.display?t.target.parentNode.parentNode.children[1].style.display="none":t.target.parentNode.parentNode.children[1].style.display="block")},!1);var h=d.getElementById("mask"),v=d.getElementById("createTask"),k=d.getElementById("taskName"),E=s[0].cloneNode(!0),B=s[0].getElementsByTagName("ul")[0].getElementsByTagName("li")[0].cloneNode(!0),C=d.createElement("ul");C.style.display="block",E.removeChild(E.children[1]),E.appendChild(C),y[0].addEventListener("click",function(){h.style.display="block"},!1),v.addEventListener("click",function(e){var l=window.event||e;if(u=JSON.parse(localStorage.getItem("localData")),null===u&&(u=[]),"noBtn"===l.target.id)h.style.display="none";else if("okBtn"===l.target.id){var i=v.getElementsByTagName("input")[1];if(i.checked){if(r(!0,k.value))return alert("重复创建"),0;t(k.value);var o={folderName:k.value,files:[]};u.push(o),k.value=null}else{if(r(!1,k.value))return alert("重复创建"),0;if(a(k.value),"H4"===m.nodeName){var d=n(),s={fileName:k.value,taskList:[]};u[d].files.push(s)}k.value=null}}localStorage.setItem("localData",JSON.stringify(u))},!1),function(){var e=JSON.parse(localStorage.getItem("localData"));if(null!==e)for(var a=0;a<e.length;a++){t(e[a].folderName);for(var n=0;n<e[a].files.length;n++)l(e[a].files[n].fileName,s[a+1])}}();var w=(d.getElementsByClassName("rightTitle"),d.getElementById("rightTitleName")),I=d.getElementById("inputTaskName"),b=d.getElementById("rightDateSpan"),S=d.getElementById("inputDate"),L=d.getElementById("rightContentRead"),T=d.getElementById("rightContentWrite"),x=d.getElementById("saveBtn"),D=d.getElementById("btnBox");N.addEventListener("click",function(e){var t=window.event||e;"A"===t.target.nodeName&&(f.style.backgroundColor=null,t.target.style.backgroundColor="rgb(255, 255, 255)",f=t.target)},!1),y[1].addEventListener("click",function(){w.style.display="none",I.style.display="block",b.style.display="none",S.style.display="inline-block",L.style.display="none",T.style.display="block",D.style.display="none"},!1);var H=d.createElement("li"),J=d.createElement("ul"),O=d.createElement("div"),A=d.createElement("div"),W=d.getElementById("dataTaskBox");A.className="dataTask",o(JSON.parse(localStorage.getItem("localData"))),x.addEventListener("click",function(e){var t=window.event||e,a=i();t.target===this.children[1]&&(w.style.display="block",I.style.display="none",b.style.display="inline-block",S.style.display="none",L.style.display="block",T.style.display="none",D.style.display="block",localStorage.setItem("localData",JSON.stringify(a)),o(a))},!1)}();